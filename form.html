<!DOCTYPE html>
<html>

<head>
    <title>Council Hearing Notice Form Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/jquery-ui.css">
    <!--  <link href="./css/style.css" rel="stylesheet">

      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
-->
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <form role="form" class="form" data-persist="garlic">
                    <fieldset>

                        <!-- Form Name -->
                        <legend>Hearing Notice Generator</legend>

                        <!-- Select Multiple -->
                        <div class="form-group">
                            <label class="form-label" for="committee_name">Committee Name</label>
                            <select class="form-control" multiple id="committee_name" name="committee_name">
                                <option>Committee on Business, Consumer, and Regulatory Affairs</option>
                                <option>Committee on Economic Development</option>
                                <option>Committee on Education</option>
                                <option>Committee on Finance and Revenue</option>
                                <option>Committee on Health</option>
                                <option>Committee on Human Services</option>
                                <option>Committee on Government Operations</option>
                                <option>Committee on the Judiciary and Public Safety</option>
                                <option>Committee on Transportation and the Environment</option>
                                <option>Committee of the Whole</option>
                            </select>
                        </div>

                        <!-- Select Basic -->
                        <div class="form-group">
                            <label class="form-label" for="councilmember">Committee Chair</label>
                            <select id="councilmember" name="councilmember" class="form-control">
                                <option>Yvette Alexander</option>
                                <option>Marion Barry</option>
                                <option>Anita Bonds</option>
                                <option>Muriel Bowser</option>
                                <option>David Catania</option>
                                <option>Mary Cheh</option>
                                <option>Jack Evans</option>
                                <option>Jim Graham</option>
                                <option>David Grosso</option>
                                <option>Kenyan McDuffie</option>
                                <option>Phil Mendelson</option>
                                <option>Vincent Orange</option>
                                <option>Tommy Wells</option>
                            </select>
                        </div>

                        <hr/>
                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="address">Committee Address</label>
                            <input class="form-control" id="address" name="address" type="text" value="1350 Pennsylvania Avenue, N.W., Suite 119, Washington, DC 20004">
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="committee_phone">Committee Phone Number</label>
                            <input class="form-control" id="committee_phone" name="committee_phone" type="text" value="202-724-8000" required="">
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="committee_contact">Committee Contact Person</label>
                            <input class="form-control" id="committee_contact" name="committee_contact" type="text" value="" required="">
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="committee_contact_email">Committee Contact Email</label>
                            <input class="form-control" id="committee_contact_email" name="committee_contact_email" type="text" placeholder="" required="">
                        </div>

                        <hr/>

                        <!-- Select Basic -->
                        <div class="form-group">
                            <label class="form-label" for="hearing_type">Hearing/Roundtable</label>
                            <select class="form-control" id="hearing_type" name="hearing_type">
                                <option>hearing</option>
                                <option>roundtable</option>
                            </select>
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="hearing_title">Hearing Title</label>
                            <input class="form-control" id="hearing_title" name="hearing_title" type="text" placeholder="" required="">
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="date">Date</label>
                            <input class="form-control" type="date" id="date" name="date" value="2014-01-23" required="">
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="time">Time</label>
                            <input class="form-control" id="time" name="time" type="time" value="10:00 am" required="">
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="room">Room Number</label>
                            <input class="form-control" id="room" name="room" type="text" value="Room 500" required="">
                        </div>

                        <!-- Textarea -->
                        <div class="form-group">
                            <label class="form-label" for="hearing_notice_body">Hearing Notice Body</label>
                            <textarea class="form-control" id="hearing_notice_body" name="hearing_notice_body" rows="8"></textarea>
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="testimony_deadline">Testimony Deadline</label>
                            <input class="form-control" id="testimony_deadline" name="testimony_deadline" type="date" value="2014-01-01" required="">
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="written_deadline">Written Testimony Deadline</label>
                            <input class="form-control" id="written_deadline" name="written_deadline" type="date" value="2014-01-01" required="">
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="form-label" for="record_close">Record Close</label>
                            <input class="form-control" id="record_close" name="record_close" type="date" value="2014-01-05" required="">
                        </div>
                        <hr/>

                        <!-- Button (Double) -->
                        <div class="form-group" align="center">
                            <button type="button" id="submit_email" name="submit_email" class="btn btn-default" onclick="submitEmail()">Submit by Email</button>
                            <button type="button" id="preview_html" name="preview_html" class="btn btn-default" onclick="previewHTML()">Preview HTML</button>
                            <button type="button" id="make_pdf" name="make_pdf" class="btn btn-default" onclick="makePDF()">Make a PDF</button>
                        </div>

                    </fieldset>
                </form>
            </div>

            <div class="col-md-6" id="rendered">

            </div>
        </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!--<script src="https://code.jquery.com/jquery.js"></script>-->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="./js/jquery-1.9.1.js"></script>
    <script src="./js/jquery-ui.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./js/moment.min.js"></script>
    <script src="./js/garlic.js"></script>
    <script src="./js/xregexp-min.js"></script>
    <script src="./js/lodash.compat.js"></script>
    <script src="./js/FileSaver.js"></script>
    <script type="text/javascript">
    var preview = '<h1>COUNCIL OF THE DISTRICT OF COLUMBIA<br /><%= committee_name %><br />NOTICE OF PUBLIC <%= hearing_type %></h1> <%= address %> <hr /> <h2><%= councilmember %><br />CHAIR, <%= committee_name %><br />ANNOUNCES A PUBLIC <%= hearing_type %><br /></h2><div class="hearing">on</div><h2><%= hearing_title %></h2> <div class="hearing"><p>on</p><p><%= date %><br /><%= time %><br /><%= room %><br />1350 Pennsylvania Avenue NW<br />Washington, DC 20004</p></div> <div class="hearing-notice-body"> <p><%= councilmember %>, Chair of the <%= committee_name %>, announces a public <%= hearing_type %> of the <%= committee_name %> on <%= hearing_title %>. The public <%= hearing_type %> will take place at <%= time %> on <%= date %> in <%= room %> of the John A. Wilson Building.</p> <p><%= hearing_notice_body %></p><p>Those who wish to testify are asked to telephone the <%= committee_name %>, at <%= committee_phone %>, or e-mail <%= committee_contact %>, at <%= committee_contact_email %>, and furnish their name, address, telephone number, and organizational affiliation, if any, by the close of business on <%= testimony_deadline %>. Persons wishing to testify are encouraged, but not required, to submit 10 copies of written testimony. If submitted by the close of business on <%= written_deadline %>, the testimony will be distributed to Councilmembers before the hearing. Witnesses should limit their testimony to three minutes; less time will be allowed if there are a large number of witnesses.</p> <p>If you are unable to testify at the hearing, written statements are encouraged and will be made a part of the official record. Copies of written statements should be submitted to the <%= committee_name %>, Council of the District of Columbia, <%= address %>. The record will close at 5:00 p.m. on <%= record_close %>.</p>';


    function submitEmail() {
        var formObj = JSON.stringify(createJSONobj(), null, '\t');
        var blob = new Blob([formObj], {
            type: "text/json; charset=utf-8"
        });
        saveAs(blob, "sample.json")
    }

    function createJSONobj() {
        var out = {};
        $('.form-control').each(function(i) {
            out[$(this).attr("id")] = $(this).val();
        });
        return out;
    }

    function previewHTML() {
        var formObj = createJSONobj();
        formObj["date"] = moment(formObj.date).format("dddd, MMMM D, YYYY");
        formObj["testimony_deadline"] = moment(formObj.testimony_deadline).format("dddd, MMMM D, YYYY");
        formObj["written_deadline"] = moment(formObj.written_deadline).format("dddd, MMMM D, YYYY");
        formObj["record_close"] = moment(formObj.record_close).format("dddd, MMMM D, YYYY");
        $('#rendered').html(link2bills(_.template(preview, formObj)));
    }

    function makePDF() {
        /*        var formObj = createJSONobj();
        var outHTML = _.template(preview, formObj); 
        var blob = new Blob([outHTML], {type: "application/xhtml;charset=utf-8"})
        saveAs(blob, "test.xhtml")
*/
        alert('working on it');
    }

    function link2bills(h) {
        // Regex is "BXX-XXX" or "PRXX-XXX" or "B XX-XXX"

        var reg = XRegExp('(?<type>(PR|Proposed Resolution)|(B|Bill))(\\s?)(?<period>\\d{1,2})(\\-)(?<number>\\d{1,4})','g');
        return XRegExp.replace(h, reg, function(d) {

          // Bill or PR?
          var t = (d.type[0] == "B" ? "B" : "PR");

          // Leading Zeros
          while (d.number.length < 4) {
             d.number = "0" + d.number;
          }

          //Build the URL
            var identifer = t + d.period + '-' + d.number;
            var url = 'http://dcclims1.dccouncil.us/lims/legislation.aspx?LegNo=' + identifer;

          //Return the Linked URL
            return linked(url, d);
        }, "all");

    }

    function linked(url, text) {
        return "<a href='" + url + "'>" + text + "</a>";
    }

    $("input[type='date']").datepicker();

    var committees = [{"committee": "Committee on Business, Consumer, and Regulatory Affairs", "chair": "Vincent Orange"}, {"committee": "Committee on Economic Development", "chair": "Muriel Bowser"}, {"committee": "Committee on Education", "chair": "David Catania"}, {"committee": "Committee on Finance and Revenue", "chair": "Jack Evans"}, {"committee": "Committee on Health", "chair": "Yvette Alexander"}, {"committee": "Committee on Human Services", "chair": "Jim Graham"}, {"committee": "Committee on Government Operations", "chair": "Kenyan McDuffie"}, {"committee": "Committee on the Judiciary and Public Safety", "chair": "Tommy Wells"}, {"committee": "Committee on Transportation and the Environment", "chair": "Mary Cheh"}, {"committee": "Committee of the Whole", "chair": "Phil Mendelson"}];

    $(document).ready(function() {
        $("#committee_name").change(function() {
            var cm = _.find(committees, {
                "committee": $("#committee_name").val()[0]
            });
            $("#councilmember").val(cm["chair"]);
        })
        $("#date").change(function () {
          var t0 = moment($("#date").val());
          var t1 = t0.subtract('days', 1).format("YYYY-MM-DD");
          var t2 = t0.add('days', 14).format("YYYY-MM-DD");
          $("#testimony_deadline").val(t1);
          $("#written_deadline").val(t1);
          $("#record_close").val(t2);
        })
    })
    </script>
</body>

</html>
